---
title: 'OHI-Northeast: Iconic Species'
author: "*Compiled on `r date()` by `r Sys.info()['user']`*"
output: 
  html_document:
    code_folding: hide
    toc: true
    toc_depth: 3
    toc_float: yes
    number_sections: false
    theme: cerulean
    highlight: haddock
    includes: 
      in_header: '~/github/ne-prep/src/templates/ohi_hdr.html'
  pdf_document:
    toc: true
---

here is a setup code chunk with many of the common parameters:
``` {r setup, echo = FALSE, message = FALSE, warning = FALSE}
knitr::opts_chunk$set(fig.width = 6, fig.height = 4, fig.path = 'figs/',
                      echo = FALSE, message = FALSE, warning = FALSE)

source('~/github/ne-prep/src/R/common.R')  ### an OHINE specific version of common.R

```

#Summary
[general description: What data are being generated? Why (what project, etc.)? Upstream/downstream processing information that might be helpful?  Other information?]

***

#Data Source [NOTE: can be copied from README.md in rawdata file]
**Reference**: [citation for source data; website, literature, contact information. Version of data (if relevant). Screenshots if a series of menus had to be navigated to obtain the data.]

**Downloaded**: [date downloaded or received]

**Description**:  [e.g., surface aragonite state]

**Native data resolution**: [e.g., 1 degree, 30 m, etc.]   

**Time range**: [e.g., 1880-1899, monthly data provided for each year] 

**Format**:  [e.g. NetCDF]

***
  
#Methods

## Load Data

Load a .csv list of our Northeast iconic species

```{r}
iconic_list <- read_csv("data/iconic_species_list.csv") %>%
  filter(!is.na(common)) %>% #not sure why we have NA rows in the raw data
  mutate(common = tolower(common),
         scientific = tolower(scientific))
```

Species range and status information

```{r}
species_status <- read_csv("~/github/ne-scores/region/layers/spp_status_scores.csv")

#filter species status just for our iconic species
iconic_species_status1 <- species_status %>%
  filter(common %in% iconic_list$common)

#filter based on scientific name
iconic_species_status2 <- species_status %>%
  filter(tolower(sciname) %in% iconic_list$scientific)

#join and add Bald eagle to common. I guess the IUCN only has the scientific name
iconic_species_status <- iconic_species_status1 %>%
  bind_rows(iconic_species_status2) %>%
  distinct() %>%
  mutate(common = ifelse(sciname == "Haliaeetus leucocephalus", "bald eagle", common),
         score = 1-score) %>% #the original scores from the SPP status are 0 (good) to 1 (bad/extinct). Here I reverse this so closer to 1 = better
  select(common, sciname, rgn_id, rgn_name, score, year) %>%
  filter(!is.na(rgn_name),  #these are holdover rows from the status data in SPP where they were used to identify USA and/or IUCN
         !is.na(score)) 
``` 

Did we get all 33 species?
```{r}
  unique(iconic_species_status$common)
```

What are we missing

```{r}
missing <- setdiff(iconic_list$common, iconic_species_status$common)
missing
```

Everything we are missing is a harvested species. We could use our stock scores for these species.

```{r}
stock_scores <- read_csv("~/github/ne-prep/prep/fis/data/nmfs_stock_scores.csv") %>%
  select(year, stock, b_bmsy) %>%
  mutate(score = ifelse(b_bmsy >=1, 1, b_bmsy)) %>%
  separate(stock, into = c("species", "area"), sep = " - ") %>%
  filter(tolower(species) %in% missing) %>%
  select(common = species, score, year)

unique(stock_scores$species)
```

Only three of those have stock assessments from NMFS that we can use as scores. So looks like we are missing american oyster, blue crab, bay scallop, soft shell clam, and quahog.

```{r}
iconic_species_status <- iconic_species_status %>%
  bind_rows(stock_scores)
```

## Find where these species exist

We don't care about how big or small the species range map is, if a species exists within an OHI region we will count it there.

```{r}
spp_rgn_areas <- read_csv("~/github/ne-scores/region/layers/spp_rgn_areas.csv") %>%
  filter(common %in% iconic_species_status$common) %>%
  select(rgn_id, common, sciname, year)
```



# Results




