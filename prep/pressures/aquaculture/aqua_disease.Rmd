---
title: 'OHI-Northeast: Aquaculture'
author: "*Compiled on `r date()` by `r Sys.info()['user']`*"
output: 
  html_document:
    code_folding: show
    toc: true
    toc_depth: 3
    toc_float: yes
    fig_caption: true
    number_sections: true
    theme: cerulean
    highlight: haddock
    includes: 
      in_header: '~/github/ohi-northeast/src/templates/ohi_hdr.html'
  pdf_document:
    toc: true
---

Disease from aquaculture production. Use the seafood watch data on the disease criteria per species and multiply by production.

Disease scores for each farmed species is criteria 7 in the Seafood Watch data. Each species get a score 0-10 with 10 being the least concern and 0 being high/critical

## Setup

``` {r setup, message = FALSE, warning = FALSE}

knitr::opts_chunk$set(fig.width = 10, fig.height = 8, fig.path = 'figs/', message = FALSE, warning = FALSE)

source('~/github/ne-prep/src/R/common.R')  ### an OHI-NE specific version of common.R

library(tidyverse)
library(ggplot2)
library(readxl)
library(stringi)
```


```{r load_directories}
## define paths and variables to use throughout data prep
dir_git <- '~/github/ne-prep' #path to the ne-prep github directory
dir_anx <- file.path(dir_M, 'git-annex/neprep') #path to the nceas server where a the bigger files are kept/saved

cols <- rev(colorRampPalette(brewer.pal(9, "Spectral"))(255)) # rainbow color scheme for maps #JULIETTE check that we don't want this color, I think we're using our own color scheme for ne
```

```{r load_data}

sf_watch_raw <- read_xlsx(file.path(dir_anx, "_raw_data/SeafoodWatch/Seafood_Watch_USAquaculture82319.xlsx"))
production <- read_csv(file.path(dir_git, "prep/mar/data/production_clean.csv")) %>% 
  mutate(Species = tolower(Species))

```

Cleaning up the seafood watch data so to be combined with production data
```{r}
sf_watch <- sf_watch_raw %>% 
  select('FAO Common name', 'AqCriteria7', 'Report Title') %>% 
  rename(report_title ='Report Title',
         Species = 'FAO Common name') %>% 
  filter(report_title != "Atlantic salmon, Global RAS" & 
         report_title != "Global Recirculating Aquaculture Systems" &
         report_title != "Clams, Global",
         report_title != 'Rainbow trout, US OLD STANDARD') %>% # there are 3 different atlantic salmon scores, we are keeping the when Report Title' == Atlantic Salmon, Atlantic North America; we are also keeping "Clams, Global NEW STANDARD" and removing the old one and same with trout
  select(-report_title) %>% 
  mutate(Species = stri_replace_all_fixed(Species, "Hard clam (unspecified)", "Hard clam"),
         Species =  tolower(Species)) %>% 
  mutate(Species =  ifelse(Species == "manila clam", "soft shell clams", # all clams have the save score, but choosing to keep these se
                           ifelse(Species == "littleneck clam", "soft shell clams",
                              ifelse(Species == "razor clam", "soft shell clams",
                                ifelse(Species == "venus clam", "soft shell clams",
                                  ifelse(Species == "lyrate hard clam", "soft shell clams",
                                        Species)))))) %>% 
  mutate(Species = ifelse(str_detect(Species, "oyster"), "oysters", Species),
         Species = ifelse(str_detect(Species, "scallop"), "scallops", Species),
         Species = ifelse(str_detect(Species, "mussel"), "blue mussel", Species),
         Species = ifelse(str_detect(Species, "trout"), "trout", Species)) %>% #all oysters, scallops, and mussels have the same score; there is only one trout species so renaming to merge with production
  unique() 
```

Combine production data and seafood watch
```{r}
disease_pro <- left_join(production, sf_watch, by = ("Species")) %>% 
  mutate(disease_prs = pounds*AqCriteria7,
         pounds = ifelse(pounds == 0, NA, pounds), # if no production the end score needs to be NA not 0
         target = pounds*10,
         rescale_score = (target- disease_prs)/(target-1))
```




