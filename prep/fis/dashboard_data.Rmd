---
title: "Fisheries Dashboard Data"
author: "*Compiled on `r date()` by `r Sys.info()['user']`*"
output: 
  html_document:
    code_folding: show
    toc: true
    toc_depth: 3
    toc_float: yes
    number_sections: false
    theme: cerulean
    highlight: haddock
    includes: 
      in_header: '~/github/ne-prep/src/templates/ohi_hdr.html'
  pdf_document:
    toc: true
---

```{r setup, message = F, warning = F, reslts = 'hide'}

knitr::opts_chunk$set(fig.width = 10, fig.height = 6, fig.path = 'figs/', message = FALSE, warning = FALSE)

source('~/github/ne-prep/src/R/common.R')

library(readr)
library(tidyverse)
library(DT)
```

## Stock assessment data

Combining the RAM and NOAA stock assessment data for display on dashboard

```{r}
ram  <- read_csv("data/ram_stock_assessment_data.csv")
noaa <- read_csv("data/nmfs_stock_assessment_data.csv") %>% select(-X1)

#get same columns as noaa

ram_clean <- ram %>%
  rename(stock = stocklong,
         indicator = metric) %>%
  select(year, stock, indicator, value)

combo <- bind_rows(ram_clean, noaa) %>%
  mutate(indicator = case_when(
    indicator == "b_bmsy" ~ "B/Bmsy",
    indicator == "f_fmsy" ~ "F/Fmsy",
    TRUE ~ as.character(indicator)
  ))

write_csv(combo, "data/stock_assessment_data_for_dashboard.csv")

```

## Data Information table

```{r}
fis_data_info <- data.frame(
  Layer = c("Catch", "Status"),
  Description = c("Total amount of targeted species caught (pounds) by statistical area",
                  "Stock assessment data on B/Bmsy and F/Fmsy (when available) to indicate health of the stock. This data comes from NMFS for US managed stocks and the RAM Legacy Database for migratory species"),
  Target = c("100 days free of any beach closures, representing the average length of the swimming season for the region",
             "B/Bmsy between 0.8 and 1.2, F/Fmsy between 0.66 and 1.2"),
  Source = c('<a href="https://foss.nmfs.noaa.gov/apexfoss/f?p=215:200:5979977158626:::::">NOAA Fisheries (NMFS) Commercial Landings</a>',
             '<a href="https://www.st.nmfs.noaa.gov/stock-assessment/">National Marine Fisheries Service (emailed)</a>
             <a href="https://www.ramlegacy.org/">RAM Legacy Database</a>')
)


write_csv(fis_data_info, "data/fis_data_info.csv")

DT::datatable(fis_data_info, escape = FALSE)
```






