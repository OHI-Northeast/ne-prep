---
title: "OHIEC: Resilience - Habitat Destruction prep"
author: "*Compiled on `r date()` by `r Sys.info()['user']`*"
output: 
  html_document:
    code_folding: hide
    toc: true
    toc_depth: 3
    toc_float: yes
    number_sections: false
    theme: cerulean
    highlight: haddock
    includes: 
      in_header: '~/github/ne-prep/src/templates/ohi_hdr.html'
  pdf_document:
toc: true
---

# Summary

This script calculates habitat resilience values by OHINE region. 

# Data

**Reference**: 

**Downloaded**: 

**Description**:  

**Time range**: 

**Format**: 


##Protected Areas Benefical to Habitat

Used a lot of the code from the lsp.Rmd
``` {r setup, message = FALSE, warning = FALSE}

knitr::opts_chunk$set(fig.width = 6, fig.height = 4, fig.path = 'figs/', message = FALSE, warning = FALSE)

source('~/github/ne-prep/src/R/common.R')  ### an OHINE specific version of common.R

library(tidyverse)
library(sf)
library(mapview)

```


Let's look at the available layers in the USGS PADUS database

```{r look_at_gdb_layers}

st_layers(file.path(dir_anx, "_raw_data/USGS/PADUS2_0_GDB_Arc10x/PADUS2_0.gdb"))

```


For the marine layer, we are going to remove all areas that are designated as fishery/shellfish management areas as well as the Special Area Management Plans. 

```{r load_and_clean_marine_layer}

marine <- read_sf(dsn = file.path(dir_anx, "_raw_data/USGS/PADUS2_0_Shapefiles/PADUS2_0Marine.shp")) %>%
  st_transform(us_alb) %>%
  st_crop(rgns)  %>%
  st_intersection(rgns) %>%
  filter(!is.na(Loc_Ds),
         d_GAP_Sts == "2 - managed for biodiversity - disturbance events suppressed" ,
         Constancy == "Year-round") %>% 
  select(Loc_Ds, Loc_Nm, Date_Est, rgn_name, rgn_id)

```

Removed this filter !Loc_Ds %in% c("Fishery Management Area", "Fishery Management Areas", "Shellfish Management Area", "Conservation Area","Gear Restricted Area", "Essential Fish Habitat Conservation Area", "Special Area Management Plan", "Closure Area"), #the Conservation Areas are for Mussel Seed


```{r interactive_map, eval = F}

 #mapview(proc, col.regions = "red") + 
usgs_data_habitat <-mapview(marine, col.regions = "blue") 

usgs_data_habitat 

```

NOAA Habitat Management Area Data

data from habitat tab on https://www.greateratlantic.fisheries.noaa.gov/educational_resources/gis/data/index.html
1) Habitat Management Area
2) Habitat Research Area
3) Frank R. Lautenberg Deep-Sea Coral Protection Area
4) Environmental Degradation Closures
5) MSB Bottom Trawling Restricted Areas


```{r}
#1
hab_manage <- read_sf(dsn = file.path(dir_anx, "_raw_data/NOAA_HAB/Habitat_Management_Areas/Habitat_Management_Areas.shp")) %>% 
  filter(DESCRIBE != "Exemption area")
#2
hab_research <- read_sf(dsn = file.path(dir_anx, "_raw_data/NOAA_HAB/Dedicated_Habitat_Research_Area/Dedicated_Habitat_Research_Area.shp"))
#3
hab_frl <- read_sf(dsn = file.path(dir_anx, "_raw_data/NOAA_HAB/Frank_R_Lautenberg_Deep_Sea_Coral_Protection_Areas/Frank_R_Lautenberg_Deep_Sea_Coral_Protection_Areas.shp"))
#4
hab_deg <- read_sf(dsn = file.path(dir_anx, "_raw_data/NOAA_HAB/Environmental_Degradation_Closures/Environmental_Degradation_Closures.shp")) %>% 
  filter(DESCRIBE != "Area closed to surfclam and ocean quahog harvest because of environmental degradation.")
#5
hab_msb_trawl <- read_sf(dsn = file.path(dir_anx, "_raw_data/NOAA_HAB/MSB_Bottom_Trawling_Restricted_Areas/MSB_Bottom_Trawling_Restricted_Areas.shp"))

#combine all together
hab_protect <- rbind(hab_manage, hab_research, hab_frl, hab_deg, hab_msb_trawl)

hab <- mapview(hab_protect) 
hab

```


grab the data for 100% closures from the marine data set and combine those
national monuments ? assume no trawling or dredging, havent added them in yet,
sea scallops don't have any dredging prohibited areas, just dreding allowed areas, figure out if they are allowed to dredge in non predetermined areas


combine hab_protect and usgs_data_habitat
combine overlapping polygons
crop out our regions 
















